<!--device.wxml-->
<!-- è®¾å¤‡ç®¡ç†é¡µ -->
<view class="container">
  <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
  <view class="top-header">
    <view class="header-content">
      <text class="page-title">è®¾å¤‡ç®¡ç†</text>
      <button class="search-btn" bindtap="startSearch">ğŸ”</button>
       <button class="settings-btn" bindtap="onSettingsTap">âš™ï¸</button>
    </view>
  </view>

  <!-- ä¸»å†…å®¹åŒºåŸŸ -->
  <view class="main-content">
    <!-- å·²ç»‘å®šè®¾å¤‡ -->
    <view class="bound-device-section">
      <text class="section-title">å·²ç»‘å®šè®¾å¤‡</text>
      
      <view wx:if="{{boundDevices.length > 0}}" class="device-list">
        <view 
          wx:for="{{boundDevices}}" 
          wx:key="deviceId"
          class="device-card"
          bindtap="connectBoundDevice"
          data-device="{{item}}">
          <view class="device-info">
            <text class="device-name">{{item.deviceName}}</text>
            <text class="device-model">{{item.model}} {{item.serial}}</text>
            <text class="device-status">å·²ç»‘å®š</text>
          </view>
          <button class="unbind-btn" bindtap="unbindDevice" data-index="{{index}}">è§£é™¤ç»‘å®š</button>
        <view wx:if="{{connectedDevice && connectedDevice.deviceId === item.deviceId}}" class="device-controls">
          <button class="ai-toggle-btn" bindtap="toggleAiMode">{{aiModeEnabled ? 'AIå¢å¼ºå·²å¼€å¯' : 'å¼€å¯AIå¢å¼º'}}</button>
        </view>
        </view>
      </view>
      
      <view wx:else class="no-device-section">
        <text class="icon">ğŸ”—</text>
        <text class="text">æš‚æ— å·²ç»‘å®šè®¾å¤‡</text>
        <button class="add-btn" bindtap="startSearch">æ·»åŠ è®¾å¤‡</button>
      </view>
    </view>

    <!-- æœç´¢ç»“æœ -->
    <view wx:if="{{searching || devices.length > 0}}" class="search-results-section">
      <text class="section-title">æœç´¢åˆ°çš„è®¾å¤‡</text>
      <text class="search-status">{{searching ? 'æœç´¢ä¸­...' : 'æœç´¢å®Œæˆ'}}</text>
      
      <view class="device-list">
        <view 
          wx:for="{{devices}}" 
          wx:key="deviceId"
          class="device-item"
          bindtap="connectDevice"
          bindlongpress="editDeviceName"
          data-device="{{item}}">
          <view class="device-item-info">
            <view class="device-name-row">
              <text class="device-item-name">{{item.name}}</text>
              <text wx:if="{{item.hasCustomName}}" class="custom-tag">è‡ªå®šä¹‰</text>
              <text wx:elif="{{item.hasSystemName}}" class="system-tag">ç³»ç»Ÿ</text>
            </view>
            <text class="device-item-model">{{item.model}} | ä¿¡å·: {{item.rssi}}dBm</text>
            <text wx:if="{{item.systemName}}" class="device-system-name">
              ç³»ç»Ÿå: {{item.systemName}}
            </text>
            <text wx:if="{{item.advertisName}}" class="device-original-name">
              å¹¿æ’­å: {{item.advertisName}}
            </text>
          </view>
          <view class="device-actions">
            <button class="connect-btn" catchtap="connectDevice" data-device="{{item}}">è¿æ¥</button>
          </view>
        </view>
      </view>
      <view class="tip-text">
        <text>æç¤ºï¼šé•¿æŒ‰è®¾å¤‡å¯è‡ªå®šä¹‰åç§°</text>
      </view>
    </view>

    <!-- æœªæœç´¢çŠ¶æ€ -->
    <view wx:if="{{!searching && devices.length === 0 && boundDevices.length === 0}}" class="no-device-section">
      <text class="icon">ğŸ‘“</text>
      <text class="text">è¯·æœç´¢å¹¶æ·»åŠ æ‚¨çš„æ™ºèƒ½çœ¼é•œè®¾å¤‡</text>
      <button class="search-btn" bindtap="startSearch">æœç´¢è®¾å¤‡</button>
    </view>
  </view>
</view>