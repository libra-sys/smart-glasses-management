<view class="container">
  <view class="header">
    <text class="title">æœåŠ¡å™¨é…ç½®</text>
    <text class="subtitle">è¿æ¥æ‚¨çš„çœ¼é•œæœåŠ¡å™¨</text>
  </view>

  <!-- å·²è¿æ¥çŠ¶æ€ -->
  <view wx:if="{{connectedServer}}" class="connected-section">
    <view class="status-badge success">
      <text class="badge-icon">âœ“</text>
      <text class="badge-text">å·²è¿æ¥</text>
    </view>

    <view class="server-info">
      <view class="info-row">
        <text class="label">æœåŠ¡å™¨åç§°</text>
        <text class="value">{{connectedServer.name}}</text>
      </view>
      <view class="info-row">
        <text class="label">IPåœ°å€</text>
        <text class="value">{{connectedServer.ip}}</text>
      </view>
      <view class="info-row">
        <text class="label">ç«¯å£</text>
        <text class="value">{{connectedServer.port}}</text>
      </view>
      <view class="info-row">
        <text class="label">ç‰ˆæœ¬</text>
        <text class="value">{{connectedServer.version}}</text>
      </view>
      <view class="info-row">
        <text class="label">è¿æ¥æ—¶é—´</text>
        <text class="value">{{connectedServer.connectedAt}}</text>
      </view>
    </view>

    <view class="actions">
      <button class="action-btn test-btn" bindtap="testConnection">
        æµ‹è¯•è¿æ¥
      </button>
      <button class="action-btn disconnect-btn" bindtap="disconnectServer">
        æ–­å¼€è¿æ¥
      </button>
    </view>
  </view>

  <!-- æœªè¿æ¥çŠ¶æ€ -->
  <view wx:else class="config-section">
    <!-- æ¨¡å¼åˆ‡æ¢ -->
    <view class="mode-tabs">
      <view 
        class="tab {{configMode === 'scan' ? 'active' : ''}}"
        data-mode="scan"
        bindtap="switchMode">
        <text class="tab-icon">ğŸ“¡</text>
        <text class="tab-text">è‡ªåŠ¨æ‰«æ</text>
      </view>
      <view 
        class="tab {{configMode === 'manual' ? 'active' : ''}}"
        data-mode="manual"
        bindtap="switchMode">
        <text class="tab-icon">âŒ¨ï¸</text>
        <text class="tab-text">æ‰‹åŠ¨è¾“å…¥</text>
      </view>
    </view>

    <!-- æ‰«ææ¨¡å¼ -->
    <view wx:if="{{configMode === 'scan'}}" class="scan-mode">
      <button 
        class="scan-btn"
        bindtap="startScan"
        loading="{{scanning}}"
        disabled="{{scanning}}">
        {{scanning ? 'æ‰«æä¸­...' : 'å¼€å§‹æ‰«æå±€åŸŸç½‘'}}
      </button>

      <view wx:if="{{discoveredServers.length > 0}}" class="server-list">
        <text class="list-title">å‘ç°çš„æœåŠ¡å™¨ ({{discoveredServers.length}})</text>
        
        <view 
          wx:for="{{discoveredServers}}" 
          wx:key="ip"
          class="server-item"
          data-server="{{item}}"
          bindtap="connectScannedServer">
          <view class="server-main">
            <text class="server-name">{{item.name}}</text>
            <text class="server-ip">{{item.ip}}:{{item.port}}</text>
          </view>
          <view class="server-info-mini">
            <text class="version">v{{item.version}}</text>
            <text class="arrow">â†’</text>
          </view>
        </view>
      </view>

      <view class="tips">
        <text class="tip-title">æ‰«æè¯´æ˜ï¼š</text>
        <text class="tip-text">â€¢ ç¡®ä¿æ‰‹æœºå’ŒæœåŠ¡å™¨åœ¨åŒä¸€WiFi</text>
        <text class="tip-text">â€¢ æœåŠ¡å™¨éœ€å¼€å¯å¹¶ç›‘å¬8081ç«¯å£</text>
        <text class="tip-text">â€¢ æ‰«æå¯èƒ½éœ€è¦1-2åˆ†é’Ÿ</text>
      </view>
    </view>

    <!-- æ‰‹åŠ¨è¾“å…¥æ¨¡å¼ -->
    <view wx:else class="manual-mode">
      <view class="input-group">
        <text class="input-label">æœåŠ¡å™¨IPåœ°å€ *</text>
        <input 
          class="input-field"
          type="text"
          placeholder="ä¾‹å¦‚ï¼š192.168.1.100"
          value="{{serverIp}}"
          bindinput="onIpInput"
        />
      </view>

      <view class="input-group">
        <text class="input-label">ç«¯å£</text>
        <input 
          class="input-field"
          type="number"
          placeholder="é»˜è®¤ï¼š8081"
          value="{{serverPort}}"
          bindinput="onPortInput"
        />
      </view>

      <view class="input-group">
        <text class="input-label">æœåŠ¡å™¨åç§°ï¼ˆå¯é€‰ï¼‰</text>
        <input 
          class="input-field"
          type="text"
          placeholder="ä¾‹å¦‚ï¼šæˆ‘çš„æ™ºèƒ½çœ¼é•œ"
          value="{{serverName}}"
          bindinput="onNameInput"
        />
      </view>

      <button class="connect-btn" bindtap="connectManual">
        è¿æ¥æœåŠ¡å™¨
      </button>

      <view class="tips">
        <text class="tip-title">é…ç½®è¯´æ˜ï¼š</text>
        <text class="tip-text">â€¢ å¯åœ¨æœåŠ¡å™¨è¿è¡Œ ipconfig æŸ¥çœ‹IP</text>
        <text class="tip-text">â€¢ é»˜è®¤ç«¯å£ä¸º8081</text>
        <text class="tip-text">â€¢ æ”¯æŒå±€åŸŸç½‘IPå’Œå…¬ç½‘åŸŸå</text>
      </view>
    </view>
  </view>
</view>
